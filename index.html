<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Wiki</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; display: flex; height: 100vh; }
        #sidebar { width: 250px; background: #f0f0f0; padding: 20px; overflow-y: auto; border-right: 1px solid #ccc; }
        #content { flex: 1; padding: 20px; overflow-y: auto; }
        .search-box { width: 100%; padding: 5px; margin-bottom: 10px; }
        .list-item { cursor: pointer; padding: 5px; border-bottom: 1px solid #ddd; }
        .list-item:hover { background: #e0e0e0; }
        .hidden { display: none; }
        h2 { border-bottom: 2px solid #333; padding-bottom: 5px; }
        .field { margin-bottom: 10px; }
        .label { font-weight: bold; }
        .locale-switch { margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="locale-switch">
        <select id="locale-select" onchange="changeLocale()">
            <option value="en">English</option>
            <option value="ru">Russian</option>
        </select>
    </div>

    <input type="text" id="search" class="search-box" placeholder="Search..." onkeyup="filterList()">

    <div id="tabs">
        <button onclick="showList('mobs')">Mobs</button>
        <button onclick="showList('items')">Items</button>
        <button onclick="showList('quests')">Quests</button>
        <button onclick="showList('recipes')">Recipes</button>
    </div>

    <div id="list-container"></div>
</div>

<div id="content">
    <h1>Welcome to the Wiki</h1>
    <p>Select an item from the left to view details.</p>
</div>

<script>
    let data = {};
    let currentLocale = 'en';
    let currentType = 'mobs';

    async function loadData() {
        const response = await fetch('wiki_data.json');
        data = await response.json();
        showList('mobs');
    }

    function getLoc(key) {
        if (data.locales && data.locales[currentLocale] && data.locales[currentLocale][key]) {
            return data.locales[currentLocale][key];
        }
        return key;
    }

    function changeLocale() {
        currentLocale = document.getElementById('locale-select').value;
        showList(currentType);
        document.getElementById('content').innerHTML = '<h1>Welcome to the Wiki</h1><p>Select an item from the left to view details.</p>';
    }

    function showList(type) {
        currentType = type;
        const container = document.getElementById('list-container');
        container.innerHTML = '';

        data[type].forEach(item => {
            const div = document.createElement('div');
            div.className = 'list-item';
            let name = item.id;
            if (type === 'quests') {
                name = getLoc(item.loc_key_name);
            } else if (type === 'recipes') {
                name = item.id; // Recipes usually don't have a direct loc key for the recipe itself, maybe use product name?
                if (item.products && item.products.length > 0) {
                     name = getLoc(item.products[0].loc_key) + " (Recipe)";
                }
            } else {
                name = getLoc(item.loc_key);
            }
            div.textContent = name;
            div.dataset.id = item.id;
            div.onclick = () => showDetails(item, type);
            container.appendChild(div);
        });
    }

    function filterList() {
        const query = document.getElementById('search').value.toLowerCase();
        const items = document.querySelectorAll('.list-item');
        items.forEach(item => {
            if (item.textContent.toLowerCase().includes(query)) {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });
    }

    function showDetails(item, type) {
        const content = document.getElementById('content');
        let html = '';

        if (type === 'mobs') {
            const name = getLoc(item.loc_key);
            html += `<h2>${name}</h2>`;
            html += `<div class="field"><span class="label">ID:</span> ${item.id}</div>`;
            html += `<div class="field"><span class="label">Level:</span> ${item.level || 'N/A'}</div>`;
            html += `<div class="field"><span class="label">Health:</span> ${item.health || 'N/A'}</div>`;
            html += `<div class="field"><span class="label">Stamina:</span> ${item.stamina || 'N/A'}</div>`;
            html += `<div class="field"><span class="label">Walk Speed:</span> ${item.walkSpeed || 'N/A'}</div>`;
            html += `<div class="field"><span class="label">Run Speed:</span> ${item.runSpeed || 'N/A'}</div>`;

            if (item.skills && item.skills.length > 0) {
                html += `<h3>Skills</h3><ul>`;
                item.skills.forEach(skillName => {
                    let skillInfo = data.skills_info[skillName];
                    let damageStr = "";
                    if (skillInfo && (skillInfo.minDamage || skillInfo.maxDamage)) {
                        damageStr = ` (Damage: ${skillInfo.minDamage || 0} - ${skillInfo.maxDamage || 0})`;
                    }
                    html += `<li>${skillName}${damageStr}</li>`;
                });
                html += `</ul>`;
            }

            if (item.drops && item.drops.length > 0) {
                html += `<h3>Drops</h3>`;
                item.drops.forEach(drop => {
                    if (drop.money) {
                        html += `<div class="field"><span class="label">Money:</span> ${drop.money.amount} - ${drop.money.amountMax || drop.money.amount} (Chance: ${drop.money.chance})</div>`;
                    }
                    if (drop.list) {
                        html += `<ul>`;
                        drop.list.forEach(group => {
                            html += `<li>Chance: ${group.chance}`;
                            if (group.randomList) {
                                html += `<ul>`;
                                group.randomList.forEach(loot => {
                                    const itemName = getLoc(`Item.${loot.typeName}`);
                                    html += `<li>${itemName} (${loot.amount || 1}${loot.amountMax ? '-' + loot.amountMax : ''})</li>`;
                                });
                                html += `</ul>`;
                            }
                            html += `</li>`;
                        });
                        html += `</ul>`;
                    }
                });
            }

        } else if (type === 'items') {
            const name = getLoc(item.loc_key);
            const desc = getLoc(item.loc_key + ".Description");
            html += `<h2>${name}</h2>`;
            if (desc !== item.loc_key + ".Description") {
                html += `<p>${desc}</p>`;
            }
            html += `<div class="field"><span class="label">ID:</span> ${item.id}</div>`;
            if (item.sellPrice) html += `<div class="field"><span class="label">Sell Price:</span> ${item.sellPrice}</div>`;
            if (item.buyUpPrice) html += `<div class="field"><span class="label">Buy Up Price:</span> ${item.buyUpPrice}</div>`;
            if (item.maxStack) html += `<div class="field"><span class="label">Max Stack:</span> ${item.maxStack}</div>`;

        } else if (type === 'quests') {
            const name = getLoc(item.loc_key_name);
            const desc = getLoc(item.loc_key_desc);
            html += `<h2>${name}</h2>`;
            html += `<p>${desc}</p>`;
            html += `<div class="field"><span class="label">ID:</span> ${item.id}</div>`;
        } else if (type === 'recipes') {
            let name = item.id;
            if (item.products && item.products.length > 0) {
                 name = getLoc(item.products[0].loc_key) + " (Recipe)";
            }
            html += `<h2>${name}</h2>`;
            html += `<div class="field"><span class="label">ID:</span> ${item.id}</div>`;

            if (item.resources && item.resources.length > 0) {
                html += `<h3>Resources</h3><ul>`;
                item.resources.forEach(res => {
                    const resName = res.loc_key ? getLoc(res.loc_key) : (res.name || 'Unknown');
                    html += `<li>${resName}: ${res.amount}</li>`;
                });
                html += `</ul>`;
            }

            if (item.products && item.products.length > 0) {
                html += `<h3>Products</h3><ul>`;
                item.products.forEach(prod => {
                    const prodName = prod.loc_key ? getLoc(prod.loc_key) : (prod.name || 'Unknown');
                    html += `<li>${prodName}: ${prod.amount}</li>`;
                });
                html += `</ul>`;
            }
        }

        content.innerHTML = html;
    }

    loadData();
</script>

</body>
</html>